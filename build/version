#!/usr/bin/env bash

# Get current branch
branch="$(git branch --show-current)"

# If detached HEAD, try to find branch from remote
if [[ -z "$branch" ]]; then
    branch="$(git branch -r --contains HEAD | grep -v HEAD | head -1 |
        sed -e 's/origin\///' -e 's/^[[:space:]]*//' -e 's/[[:space:]]*$//')"
fi

# For master or hotfix/* branches, use only x.y.z.w part
if [[ "$branch" == "master" || "$branch" =~ ^hotfix/ ]]; then
    rev="$(git describe --tags --always --long | cut -d'-' -f1)"
else
    # Other branches, use full git describe
    rev="$(git describe --tags --always --abbrev=9)"
fi

echo "$rev"
